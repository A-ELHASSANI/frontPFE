<main id="main-container">
  <!-- Navbar -->
  <div
    class="bg-body-light"
    (scroll)="onscroll()"
    [ngClass]="navbarfixed ? 'fixed' : 'nofixed'"
  >
    <div class="content content-center">
      <div
        class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center py-2"
      >
        <div class="flex-grow-1">
          <div class="input-daterange input-group">
            <h3 id="bookYourStay" class="block-title">BOOK YOUR STAY</h3>

            <!-- Date From -->
            <p-calendar
              [(ngModel)]="dateFrom"
              [maxDate]="dateTo"
              placeholder="From"
              dateFormat="dd/mm/yyyy"
              [ngClass]="{'error-border': dateFromError}"
              (ngModelChange)="validateDates()"
            ></p-calendar>


            <span class="input-group-text fw-semibold">
              <i class="fa fa-arrow-right"></i>
            </span>

            <!-- Date To -->
            <p-calendar
              [(ngModel)]="dateTo"
              [minDate]="dateFrom"
              placeholder="To"
              dateFormat="dd/mm/yyyy"
              [ngClass]="{'error-border': dateToError}"
              (ngModelChange)="validateDates()"
            ></p-calendar>


            <!-- Filters and Search Buttons -->
            <button
              class="btn btn-lg rounded-pill btn-alt-secondary me-2"
              style="margin-left:7px ;"
              (click)="visible = true"
            >
              <i class="pi pi-filter"></i> Filters
            </button>
            <button
              pButton
              pRipple
              label="Search"
              icon="pi pi-search"
              class="btn btn-sm rounded-pill btn-outline-dark me-1"
              (click)="applyFilters()"
            ></button>
          </div>


        </div>
      </div>
    </div>
  </div>

  <!-- Room Cards -->
  <div class="hotel-cards-container">
    <div class="hotel-card" *ngFor="let room of filteredRooms">
      <!-- Room Image Carousel -->
      <div class="hotel-left">
        <div *ngIf="room.photos?.length; else noPhoto">
          <div
            id="carousel-{{ room.numeroChambre }}"
            class="carousel slide carousel-fade"
          >
            <div class="carousel-inner">
              <div
                *ngFor="let photo of room.photos; let i = index"
                class="carousel-item"
                [class.active]="i === 0"
              >
                <img
                  [src]="'data:image/jpeg;base64,' + photo"
                  class="d-block w-100"
                  alt="Room photo"
                  style="height: 300px; object-fit: cover;"
                />
              </div>
            </div>
            <button
              class="carousel-control-prev"
              type="button"
              [attr.data-bs-target]="'#carousel-' + room.numeroChambre"
              data-bs-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              [attr.data-bs-target]="'#carousel-' + room.numeroChambre"
              data-bs-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
            </button>

            <!-- Custom Indicators -->
            <div class="carousel-indicators">
              <button
                *ngFor="let photo of room.photos; let i = index"
                [attr.data-bs-target]="'#carousel-' + room.numeroChambre"
                [attr.data-bs-slide-to]="i"
                [class.active]="i === 0"
                class="carousel-indicator"
              ></button>
            </div>
          </div>
        </div>

        <ng-template #noPhoto>
          <div class="no-photo-placeholder text-center">
            No Photos Available
          </div>
        </ng-template>
      </div>

      <!-- Room Details -->
      <div class="hotel-right">
        <h2 class="hotel-title">{{ room.numeroChambre }} - {{ room.type }}</h2>
        <span
          class="badge me-2"
          [ngClass]="{
            'bg-success': room.etat === 'DISPONIBLE',
            'bg-danger': room.etat === 'OCCUPEE',
            'bg-warning': room.etat === 'EN_ENTRETIEN'
          }"
        >
          {{ room.etat }}
        </span>
        <p class="description">
          {{ room.description || "No description available." }}
        </p>
        <div class="price-section">
          <span class="price">{{ room.prix }} MAD / nuit</span>
          <button class="btn btn-primary btn-sm mt-2" (click)="openBookingDialog(room)">
            Book
          </button>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Filter Dialog -->
<p-dialog
  header="Filtres"
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
>


  <!-- Room Type Filter -->
  <div class="filter-section">
    <h4>Room Type</h4>
    <p-multiSelect
      [options]="roomTypes"
      [(ngModel)]="selectedRoomTypes"
      defaultLabel="Select Room Types"
    ></p-multiSelect>
  </div>

  <!-- Availability Filter -->
  <div class="filter-section">
    <h4>Availability</h4>
    <p-dropdown
      [options]="availabilityOptions"
      [(ngModel)]="selectedAvailability"
      placeholder="Select Availability"
    ></p-dropdown>
  </div>
  <!-- Price Filter -->
  <div class="filter-section">
    <h4>Price Range</h4>
    <p-slider
      [(ngModel)]="priceRange"
      [min]="100"
      [max]="1000"
      [range]="true"
    ></p-slider>
    <p>{{ priceRange[0] }} MAD - {{ priceRange[1] }} MAD</p>
  </div>
  <!-- Buttons -->
  <div class="dialog-footer">
    <button
      pButton
      label="Reset"
      (click)="resetFilters()"
      class="p-button-text"
    ></button>
    <button
      pButton
      label="Apply"
      icon="pi pi-check"
      class="p-button-primary"
      (click)="applyFilters()"
    ></button>
  </div>
</p-dialog>
